<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Chuẩn bị môi trường lập trình Java – Hướng dẫn cài OpenJDK, IntelliJ, Git
      Bash trên Windows - StuShare
    </title>
    <meta
      name="description"
      content="Tài liệu trình chiếu chi tiết cách thiết lập môi trường lập trình Java trên Windows: cài đặt OpenJDK 11, IntelliJ IDEA, Git Bash, chạy Hello World, sử dụng wrapper algs4. Dành cho sinh viên học cấu trúc dữ liệu & thuật toán."
    />
    <link rel="stylesheet" href="/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
  </head>
  <body class="has-fixed-breadcrumb">
    <div id="header-placeholder"></div>
    <div id="breadcrumb-placeholder"></div>

    <main>
      <section class="document-viewer-section">
        <div class="presentation-container">
          <div class="iframe-controls">
            <button
              class="iframe-nav-btn"
              id="iframe-home"
              title="Về trang chủ của website"
            >
              <i class="fas fa-home"></i>
            </button>
            <a
              href="#"
              id="iframe-open-new-tab"
              class="iframe-nav-btn"
              target="_blank"
              rel="noopener noreferrer"
              title="Mở trong tab mới"
              ><i class="fas fa-external-link-alt"></i
            ></a>
          </div>

          <div class="presentation-wrapper">
            <iframe
              id="website-iframe"
              src="https://chauttm.github.io/dsa-web/labs/windows.html"
              loading="lazy"
              referrerpolicy="no-referrer"
              allowfullscreen
              title="Chuẩn bị môi trường lập trình Java"
            ></iframe>
          </div>
        </div>
      </section>

      <section class="comments-section" style="padding: 40px 0">
        <div class="container comments-shell">
          <div class="comments-toolbar">
            <h2 class="section-title">Thảo luận</h2>
          </div>

          <form id="comment-form" class="comment-main-form">
            <div class="avatar" id="main-form-avatar">?</div>
            <div class="form-content">
              <div class="form-row">
                <input
                  type="text"
                  id="comment-name"
                  placeholder="Thêm tên của bạn..."
                  required
                />
              </div>
              <div class="form-row">
                <textarea
                  id="comment-text"
                  placeholder="Chia sẻ điều bạn nghĩ..."
                  rows="1"
                  required
                ></textarea>
              </div>
              <input
                type="text"
                id="hp-website"
                name="website"
                autocomplete="off"
                style="display: none"
              />
              <div class="form-actions">
                <button type="button" class="btn btn-secondary cancel-btn">
                  Hủy
                </button>
                <button type="submit" class="btn btn-primary" disabled>
                  Bình luận
                </button>
              </div>
            </div>
          </form>

          <div id="comments-container" class="comments-list">
            <!-- skeleton khi đang tải -->
            <div class="comment-skeleton"></div>
            <div class="comment-skeleton"></div>
            <div class="comment-skeleton"></div>
          </div>

          <div class="comments-footer">
            <button
              id="comments-load-more"
              class="btn btn-secondary"
              style="display: none"
            >
              Xem thêm
            </button>
          </div>

          <div id="comments-toast" class="toast"></div>
        </div>
      </section>
    </main>

    <div id="footer-placeholder"></div>
    <script src="/assets/js/layout.js"></script>
    <script>
      let FORM_STARTED_AT = Date.now(); // đo thời gian điền form
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
          const iframe = document.getElementById('website-iframe');
          const homeBtn = document.getElementById('iframe-home');
          const openNewTabBtn = document.getElementById('iframe-open-new-tab');
          const originalSrc = iframe.src;
          homeBtn.addEventListener('click', () => { iframe.src = originalSrc; });
          openNewTabBtn.href = originalSrc;
      });

        document.addEventListener("DOMContentLoaded", function () {
          const SCRIPT_URL =
            "https://script.google.com/macros/s/AKfycbxGdIvBCFFCQGvX0bJxdrIMVz3uP5mZ9L7pEper1YiGQMp2HOtXwCMXNjCfJ7MD0exA/exec"; // QUAN TRỌNG
          const PAGE_ID = window.location.pathname.replace(/[^a-zA-Z0-9]/g, "_");

          // === DEVICE ID MANAGEMENT ===
          function ensureDeviceId() {
            let uid = localStorage.getItem("ss_device_id");
            if (!uid) {
              uid =
                "d_" + Date.now() + "_" + Math.random().toString(36).slice(2, 9);
              localStorage.setItem("ss_device_id", uid);
            }
            return uid;
          }
          const DEVICE_ID = ensureDeviceId();

          // === STATE QUẢN LÝ TRẠNG THÁI ===
          const state = { raw: [], tree: [], page: 1, pageSize: 10 };

          // === DOM ELEMENTS ===
          const el = {
            container: document.getElementById("comments-container"),
            form: document.getElementById("comment-form"),
            nameInput: document.getElementById("comment-name"),
            commentInput: document.getElementById("comment-text"),
            formActions: document.querySelector(
              ".comment-main-form .form-actions"
            ),
            mainAvatar: document.getElementById("main-form-avatar"),
            submitBtn: document.querySelector(
              '.comment-main-form button[type="submit"]'
            ),
            cancelBtn: document.querySelector(".comment-main-form .cancel-btn"),
            loadMore: document.getElementById("comments-load-more"),
            toast: document.getElementById("comments-toast"),
          };

          // === HELPER FUNCTIONS ===
          const formatTimeAgo = (dateInput) => {
            const date = new Date(dateInput);
            if (isNaN(date.getTime())) return "";
            const now = new Date();
            const seconds = Math.round((now - date) / 1000);
            if (seconds < 5) return "vừa xong";
            const minutes = Math.round(seconds / 60);
            const hours = Math.round(minutes / 60);
            const days = Math.round(hours / 24);
            if (minutes < 60) return `${minutes} phút trước`;
            if (hours < 24) return `${hours} giờ trước`;
            return `${Math.round(hours / 24)} ngày trước`;
          };

          const generateCommentId = () =>
            `comment_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

          const escapeHTML = (str) =>
            String(str).replace(
              /[&<>"']/g,
              (m) =>
                ({
                  "&": "&amp;",
                  "<": "&lt;",
                  ">": "&gt;",
                  '"': "&quot;",
                  "'": "&#39;",
                }[m])
            );

          const showToast = (msg, isSuccess = true) => {
            if (!el.toast) return;
            el.toast.textContent = msg;
            el.toast.style.background = isSuccess ? "#28a745" : "#dc3545";
            el.toast.classList.add("show");
            setTimeout(() => el.toast.classList.remove("show"), 10000);
          };

          // --- NEW: Hàm tạo màu sắc động cho Avatar ---
          const nameToColor = (name) => {
            let hash = 0;
            for (let i = 0; i < name.length; i++) {
              hash = name.charCodeAt(i) + ((hash << 5) - hash);
            }
            const h = hash % 360;
            return `hsl(${h}, 70%, 60%)`;
          };

          // --- NEW: Hàm tạo màu ngẫu nhiên cho avatar mặc định ---
          const getRandomColor = () => {
            const h = Math.floor(Math.random() * 360);
            return `hsl(${h}, 70%, 60%)`;
          };

          // === CORE LOGIC: DATA PROCESSING & RENDERING ===
          const buildCommentTree = (comments) => {
            const commentMap = new Map();
            comments.forEach((c) => {
              if (c && c.comment_id)
                commentMap.set(c.comment_id, { ...c, replies: [] });
            });
            const tree = [];
            commentMap.forEach((comment) => {
              if (comment.parent_id && commentMap.has(comment.parent_id)) {
                commentMap.get(comment.parent_id).replies.push(comment);
              } else {
                tree.push(comment);
              }
            });
            return tree;
          };

          const createCommentHTML = (comment, level = 1) => {
            const author = escapeHTML(comment.name || "Ẩn danh");
            const initial = author.charAt(0).toUpperCase();
            const avatarColor = nameToColor(author);
            const timeDisplay = formatTimeAgo(comment.timestamp);
            const body = escapeHTML(comment.comment || "").replace(/\n/g, "<br>");
            const cid = escapeHTML(comment.comment_id);

            // --- NEW: Ẩn nút trả lời nếu đã đạt cấp 4 ---
            const replyButtonHTML =
              level < 4
                ? `<button class="reply-btn-text reply-btn" data-comment-id="${cid}">Trả lời</button>`
                : "";

            return `
              <div class="thread-item">
                <div class="avatar" style="background-color: ${avatarColor};">${initial}</div>
                <div class="col">
                  <div class="meta">
                    <span class="author">${author}</span>
                    <span class="time">${timeDisplay}</span>
                  </div>
                  <div class="body">${body}</div>
                  <div class="actions">
                    <button class="action-btn like-btn" data-cid="${cid}">
                      <i class="far fa-thumbs-up"></i><span class="like-count" style="margin-left: 4px;">${
                        comment.like_count || 0
                      }</span></button
                    ><button class="action-btn dislike-btn" data-cid="${cid}">
                      <i class="far fa-thumbs-down"></i><span class="dislike-count" style="margin-left: 4px;">${
                        comment.dislike_count || 0
                      }</span></button
                    >${replyButtonHTML}
                  </div>
                  <div class="reply-form-container" id="reply-form-for-${cid}"></div>
                  <div class="replies" id="replies-to-${cid}"></div>
                </div>
              </div>`;
          };

          const renderCommentList = (comments, container, level = 1) => {
            const sorted = comments
              .slice()
              .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const frag = document.createDocumentFragment();
            sorted.forEach((c) => {
              const wrapper = document.createElement("div");
              wrapper.className = "thread";
              wrapper.innerHTML = createCommentHTML(c, level);
              frag.appendChild(wrapper);
              if (Array.isArray(c.replies) && c.replies.length && level < 4) {
                const repliesContainer = wrapper.querySelector(
                  `#replies-to-${c.comment_id}`
                );
                if (repliesContainer)
                  renderCommentList(c.replies, repliesContainer, level + 1);
              }
            });
            container.innerHTML = "";
            container.appendChild(frag);
          };

          const reRenderWithControls = () => {
            const sorted = state.tree
              .slice()
              .sort((a, b) => new Date(b.timestamp) - new Date(a.
    </script>
  </body>
</html>
